/**
  * Created by Amr on 10/21/2016.
  */


import org.broadinstitute.mdreport.RetrieveMetrics
import org.scalatest.{FlatSpec, Matchers}

class RetrieveMetricsSpec extends FlatSpec with Matchers {

  "RetrieveMetrics" should "return a list of expected metrics with default versioning" in {
    val rm = new RetrieveMetrics("EntryCreatorSystemTest1", 1)
    val metrics = rm.retrieve()
    val expected = List(",ErccStats,,,,,,PicardMeanQualByCycle,,PicardReadGcMetrics,RnaSeqQcStats,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,PicardAlignmentSummaryAnalysis,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,PicardInsertSizeMetrics,,,,,,,,,,,,,,,,,", ",fractionErccReads,fractionGenomeReferenceReads,totalReads,totalUnalignedReads,fractionUnalignedReads,totalErccReads,r2MeanQual,r1MeanQual,meanGcContent,readMetrics,,,,,,,,,,,covMetrics,,alignmentMetrics,,,,,,,,,,gapMetrics,,,annotationMetrics,,,,,,,endMetrics,,,,,,,,,,note,sample,PicardAlignmentSummaryMetrics,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,widthOf70Pct,widthOf40Pct,meanInsertSize,widthOf10Pct,widthOf30Pct,widthOf50Pct,widthOf90Pct,readPairs,widthOf99Pct,maxInsertSize,medianAbsoluteDeviation,pairOrientation,widthOf20Pct,medianInsertSize,minInsertSize,standardDeviation,widthOf80Pct,widthOf60Pct", ",,,,,,,,,,ReadMetrics,,,,,,,,,,,CovMetrics,,AlignmentMetrics,,,,,,,,,,GapMetrics,,,AnnotationMetrics,,,,,,,EndMetrics,,,,,,,,,,,,pfHqAlignedBases,totalReads,pfAlignedBases,pfNoiseReads,pctChimeras,pfMismatchRate,pfHqAlignedQ20Bases,pctAdapter,pctPfReads,pfHqErrorRate,pctPfReadsAligned,pfHqAlignedReads,readsAlignedInPairs,pctReadsAlignedInPairs,pfReadsAligned,pfReads,category,pfHqMedianMismatches,badCycles,meanReadLength,strandBalance,pfIndelRate,pfHqAlignedBases,totalReads,pfAlignedBases,pfNoiseReads,pctChimeras,pfMismatchRate,pfHqAlignedQ20Bases,pctAdapter,pctPfReads,pfHqErrorRate,pctPfReadsAligned,pfHqAlignedReads,readsAlignedInPairs,pctReadsAlignedInPairs,pfReadsAligned,pfReads,category,pfHqMedianMismatches,badCycles,meanReadLength,strandBalance,pfIndelRate,pfHqAlignedBases,totalReads,pfAlignedBases,pfNoiseReads,pctChimeras,pfMismatchRate,pfHqAlignedQ20Bases,pctAdapter,pctPfReads,pfHqErrorRate,pctPfReadsAligned,pfHqAlignedReads,readsAlignedInPairs,pctReadsAlignedInPairs,pfReadsAligned,pfReads,category,pfHqMedianMismatches,badCycles,meanReadLength,strandBalance,pfIndelRate,,,,,,,,,,,,,,,,,,", ",,,,,,,,,,fragmentLengthMean,chimericPairs,readLength,estimatedLibrarySize,fragmentLengthStdDev,expressionProfilingEfficiency,unpairedReads,baseMismatchRate,transcriptsDetected,totalPurityFilteredReadsSequenced,failedVendorQCCheck,meanPerBaseCov,meanCV,mapped,mappedPairs,alternativeAlignments,uniqueRateofMapped,mappingRate,mappedUnique,end1MappingRate,end2MappingRate,mappedUniqueRateofTotal,duplicationRateOfMapped,cumulGapLength,gapPct,numGaps,intronicRate,rRNA,genesDetected,rRNArate,exonicRate,intragenicRate,intergenicRate,end1PctSense,end1Antisense,noCovered5Prime,end2MismatchRate,end2Antisense,end2PctSense,end2Sense,end1MismatchRate,end1Sense,fivePrimeNorm,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,", ".EntryCreatorSystemTest1,0.0319489,0.84419,2368092,293314,0.123861,75658,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,", "test.EntryCreatorSystemTest1,0.0319489,0.84419,2368092,293314,0.123861,75658,34.99,36.18,48.0,144,21916,25,2907488,-1.0,0.643255,0,0.0022569934,35367,2368092,0,0.45236537,1.6897788,2074778,1037349,-1,0.8410529,0.8761391,1744998,0.8761391,0.8761391,0.7368793,0.15894713,1350146,0.6802336,17621,0.15844394,0,9913,-1.0,0.7341928,0.8926367,0.10732715,48.7648,398990,-1,379270.0,396519,48.888294,379270,379752.0,379752,0.33317196,Notes,Mouse-A2-single,0,1184046,0,0,0.0,0.0,-1,2.8E-5,1.0,0.0,0.0,0,0,0.0,0,1184046,FIRST_OF_PAIR,0.0,0,25,0,0.0,0,1184046,0,0,0.0,0.0,-1,7.9E-5,1.0,0.0,0.0,0,0,0.0,0,1184046,SECOND_OF_PAIR,0.0,0,25,0,0.0,0,2368092,0,0,0.0,0.0,-1,5.4E-5,1.0,0.0,0.0,0,0,0.0,0,2368092,PAIR,0.0,0,25,0,0.0,1317,393,610.388274,105,299,499,12077,872499,102991,1071533,249,FR,205,481,17,592.897433,4577,649")
    metrics should contain theSameElementsAs expected
  }
  it should "return a list of expected metrics with non-default versioning" in {
    val rm = new RetrieveMetrics("SSF-1751", 1477521489932L)
    val metrics = rm.retrieve()
    val expected = List(",PicardInsertSizeMetrics,,,,,,,,,,,,,,,,,,PicardAlignmentSummaryAnalysis,,,,,,,,,,,,,,,,,,,,,,ErccStats,,,,,,PicardMeanQualByCycle,,RnaSeqQcStats,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,, ,widthOf70Pct,widthOf40Pct,meanInsertSize,widthOf10Pct,widthOf30Pct,widthOf50Pct,widthOf90Pct,readPairs,widthOf99Pct,maxInsertSize,medianAbsoluteDeviation,pairOrientation,widthOf20Pct,medianInsertSize,minInsertSize,standardDeviation,widthOf80Pct,widthOf60Pct,PicardAlignmentSummaryMetrics,,,,,,,,,,,,,,,,,,,,,,fractionErccReads,fractionGenomeReferenceReads,totalReads,totalUnalignedReads,fractionUnalignedReads,totalErccReads,r2MeanQual,r1MeanQual,readMetrics,,,,,,,,,,,covMetrics,,alignmentMetrics,,,,,,,,,,gapMetrics,,,annotationMetrics,,,,,,,endMetrics,,,,,,,,,,note,sample, ,,,,,,,,,,,,,,,,,,,pfHqAlignedBases,totalReads,pfAlignedBases,pfNoiseReads,pctChimeras,pfMismatchRate,pfHqAlignedQ20Bases,pctAdapter,pctPfReads,pfHqErrorRate,pctPfReadsAligned,pfHqAlignedReads,readsAlignedInPairs,pctReadsAlignedInPairs,pfReadsAligned,pfReads,category,pfHqMedianMismatches,badCycles,meanReadLength,strandBalance,pfIndelRate,,,,,,,,,ReadMetrics,,,,,,,,,,,CovMetrics,,AlignmentMetrics,,,,,,,,,,GapMetrics,,,AnnotationMetrics,,,,,,,EndMetrics,,,,,,,,,,,, ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,fragmentLengthMean,chimericPairs,readLength,estimatedLibrarySize,fragmentLengthStdDev,expressionProfilingEfficiency,unpairedReads,baseMismatchRate,transcriptsDetected,totalPurityFilteredReadsSequenced,failedVendorQCCheck,meanPerBaseCov,meanCV,mapped,mappedPairs,alternativeAlignments,uniqueRateofMapped,mappingRate,mappedUnique,end1MappingRate,end2MappingRate,mappedUniqueRateofTotal,duplicationRateOfMapped,cumulGapLength,gapPct,numGaps,intronicRate,rRNA,genesDetected,rRNArate,exonicRate,intragenicRate,intergenicRate,end1PctSense,end1Antisense,noCovered5Prime,end2MismatchRate,end2Antisense,end2PctSense,end2Sense,end1MismatchRate,end1Sense,fivePrimeNorm,,, SSF-1751.SSF1859A02_A375_AkiYoda,1739,439,564.539356,117,335,543,30853,487045,1591137,1873889,271,FR,227,471,14,591.211632,7133,679,-1,-1,-1,-1,-1.0,-1.0,-1,-1.0,-1.0,-1.0,-1.0,-1,-1,-1.0,-1,-1,N/A,-1.0,-1,-1,-1,-1.0,-1.0,-1.0,-1,-1,-1.0,-1,32.82,33.93,89,722132,25,505052,-1.0,0.071539976,0,0.01425468,43277,18222664,0,0.27372354,2.6237726,3367610,1642184,-1,0.2892526,0.18480338,974090,0.18480338,0.18480338,0.05345486,0.71074736,1321865,0.83605355,8704,0.058009688,0,8991,-1.0,0.38711402,0.4451237,0.5301861,64.120155,255284,-1,313188.0,334576,48.34909,313188,456213.0,456213,0.29732943,Notes,SSF1859A02_A375_AkiYoda, SSF-1751.SSF1859A03_A375_AkiYoda,1671,425,550.675225,111,323,531,31085,495537,1634389,1854124,265,FR,219,464,16,573.475193,7111,667,-1,-1,-1,-1,-1.0,-1.0,-1,-1.0,-1.0,-1.0,-1.0,-1,-1,-1.0,-1,-1,N/A,-1.0,-1,-1,-1,-1.0,-1.0,-1.0,-1,-1,-1.0,-1,32.76,33.89,89,797296,25,506512,-1.0,0.07050946,0,0.013297061,43696,19560806,0,0.29631212,2.5919123,3881862,1834114,-1,0.25530893,0.19845103,991074,0.19845103,0.19845103,0.050666317,0.7446911,1132731,0.8260735,8153,0.07357552,0,9099,-1.0,0.3552991,0.42887458,0.51623476,63.74719,287744,-1,353033.0,366496,49.064457,353033,505971.0,505971,0.2820824,Notes,SSF1859A03_A375_AkiYoda, SSF-1751.SSF1859A01_A375_AkiYoda,2169,469,608.873168,127,359,581,33681,652533,1626717,1780950,290,FR,247,486,15,660.51853,7703,731,-1,-1,-1,-1,-1.0,-1.0,-1,-1.0,-1.0,-1.0,-1.0,-1,-1,-1.0,-1,-1,N/A,-1.0,-1,-1,-1,-1.0,-1.0,-1.0,-1,-1,-1.0,-1,32.8,33.9,91,1074986,25,667593,-1.0,0.074396394,0,0.01474108,47172,26755180,0,0.40987048,2.3899598,5062614,2487961,-1,0.25778502,0.18921995,1305066,0.18921995,0.18921995,0.04877807,0.742215,1162019,0.787786,9494,0.057766207,0,9941,-1.0,0.39317417,0.45094037,0.5319916,64.07588,385640,-1,475329.0,500957,48.687473,475329,687845.0,687845,0.34374952,Notes,SSF1859A01_A375_AkiYoda")

    println(metrics)

  }
}
